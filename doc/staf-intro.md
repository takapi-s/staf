STAF は、AIを使って CSV にデータを付与・拡張するツールです。既存の値の補完・正規化、カテゴリ付与や情報抽出に対応し、必要に応じて Web 検索（グラウンディング）で根拠を添えた付与も行えます。営業・マーケ・リサーチなどの大量リストを、短時間で“使えるデータセット”に変換します。    
@[card](https://github.com/takapi-s/staf)
---

### なぜ作ったのか
現場で、急遽「アーティスト一覧をスクレイピングしてほしい」「美術館の情報を集めてほしい」といった依頼が立て続けに発生しました。対象は1,000件規模になることも多く、順次スクレイピングするのは非現実的。さらに公式APIが見つからないケースもしばしばありました。

このとき、Gemini の Web 検索を使い、CSVに必要情報をまとめるワークフローを何度も組みました。そこで「どんなインプットでも同じ体裁で回せて、プロンプトを都度変えられるUIがあるツール」があれば、面倒な手作業依頼が自分に集中せず、誰でも同じ品質で回せるはず——そう期待して STAF を作りました。

STAF は、既存のCSVに対して新しい列を安全に付与（エンリッチ）することにフォーカスしています。APIが無い/使えない状況でも、検索＋整形で一定の品質に揃え、再現可能な形でチームに手渡せることを目指しています。

---

### 何ができる？
- **スキーマ準拠のAIエンリッチメント**: 出力列（型・ネスト）を定義→JSONスキーマ化→Gemini から厳密な JSON を返させ、元のCSVに安全にマージ（付与・抽出・正規化・分類・スコアリング）
- **高速・安定**: 並列数・レート（RPM）・タイムアウトを設定でき、数千〜数万行でも現実的に回せる
- **見える化**: 進捗・アクティブリクエスト数・エラー状況をUIで可視化。実行ログは JSONL で自動保存
- **テンプレート**: よく使うプロンプト/出力列/設定を保存し、同じ処理を繰り返し再現
- **CSVエクスポート**: 成功・失敗を含む結果を簡単にCSV出力

---

### アプリUI
![](https://storage.googleapis.com/zenn-user-upload/739db0ff11bb-20251108.png)
![](https://storage.googleapis.com/zenn-user-upload/0fa359140125-20251108.png)

### 使い方
1. アプリ起動 → 右上の「Settings」で Google Gemini API キーを入力
3. CSV を読み込む（プレビューで確認）  
4. 「Prompt（テンプレ）」を作成（行の値は `{{columnName}}` で差し込み）  
5. 「Output Columns（出力列）」を型/ネスト含めて定義（これがJSONスキーマになる）  
6. 「Start」実行 → 進捗と結果を確認 → 「Export CSV」で保存


#### /examples を使ったチュートリアル（最短で一周）
付属の `examples` フォルダを使って、最小の流れを確認します。

1) サンプルCSVを読み込む（プレビューで確認）  
`examples/example.input.csv` を選択します。差し込みに使う列は `artist_name` と `year` です。

```1:4:examples/example.input.csv
artist_name,year
Aimer, 2024
Aimer, 2023
YOASOBI, 2024
```

2) プロンプトを設定する  
`examples/example.prompt.txt` の内容を「Prompt（テンプレ）」に貼り付けます。  
行ごとの値が `{{artist_name}}`、`{{year}}` に差し込まれます。

```1:26:examples/example.prompt.txt
あなたは音楽業界の売上分析専門家です
Google検索の高度なグラウンディング機能を活用し、以下のアーティスト情報を正確かつ網羅的に収集してください。

**目的:** アーティスト『{{artist_name}}』の指定年『{{year}}』におけるイベント情報、およびそのアーティストの出身地を特定すること

**検索指示:**
1.  **イベント情報:** 『{{artist_name}}』の『{{year}}』年におけるコンサート、ライブ、フェスティバル出演、その他主要な公開イベント（開催済みまたは発表済み）の詳細情報を特定してください。
2.  **出身地:** 『{{artist_name}}』の出生地または出身地（都道府県レベルで特定可能な場合）を検索してください。

**出力指示:**
以下のルールに従って情報を構築してほしい

*   `events`: 発見されたイベントの配列を含めてください。
    *   各イベントは、`title` (イベント名、string型), `date` (開催日または期間、string型), `ticket_price` (チケット価格、数値型。情報が見つからない場合は `0` を設定してください), `venue` (会場名、string型、例: 東京ドーム) のキーを持つオブジェクトです。
    *   **イベント情報が見つからない場合**は、`events` は空の配列 `[]` としてください。
*   `Birthplace`: 『{{artist_name}}』の出身地（都道府県名、string型、例: 東京都、岡山県）。
    *   **出身地情報が見つからない場合**は、`Birthplace` は空文字列 `""` としてください。

        **重要**: チケット価格は税込価格で、**必ず日本円（JPY）で統一**してください：
        - 海外アーティストの場合は、ドルやユーロを日本円に換算
        - **換算レート：1ドル = 152.46円（2024年10月時点）**
        - 全世界の公演価格を対象とし、統一された日本円換算で記載
        - 全席指定：通常のチケット価格（最低価格として使用）
        - プレミアムチケット：高額な特別席（最高価格として使用）
        - 特典付きチケット：グッズ付きなどの高額チケット（最高価格の候補）
```

3) 出力列（Output Columns）を定義する  
以下のスキーマどおりに列を作成します（型は必ず一致させてください）。
jsonインプットがあるので簡単にできると思います。

```1:11:examples/example.output.json
{
    "events": [
        {
            "title": "string",
            "date": "string",
            "ticket_price": "number",
            "venue": "string"
        }
    ],
    "Birthplace": "string"
}
```

4) 実行する  
「Start」を押して実行します。必要に応じて Web 検索（グラウンディング）を有効化してください。  

5) 結果を確認する  
出力のイメージは `examples/example.output.json` を参照してください（構造と型が一致していればOK）。



6) CSV にエクスポートする  
「Export CSV」を押すと、元のCSVに新しい列が安全にマージされたファイルを保存できます（成功/失敗を含めて出力可能）。

小さなデータで流れを確認してほしい

---

### 実務で効くユースケース
- **レビューの要約＋感情/トピック抽出**を列化  
- **顧客リストのタグ付け/スコアリング**（説明文からカテゴリ付与）  
- **FAQや問い合わせの構造化**（Q/A抽出、正規化）  
- **自由記述からのリード情報抽出**（会社名・役職・ニーズなど）  

---

### 仕組み
- 定義済みスキーマを Gemini に渡し、`application/json` で厳密なJSONのみを要求
- 必要に応じて「検索で根拠収集 → スキーマ準拠JSON化」の二段構え  
  - 検索で事実を要約（中間ノート）  
  - 中間ノートをもとにスキーマに沿ったJSONを生成  
- すべての入出力/中間ノートを JSON Lines で保存でき、監査や再現性を確保

---

### 技術スタック
- **UI**: React 19 / React Router 7 / TailwindCSS 4 
- **デスクトップ**: Tauri 2 + Rust（高パフォーマンス＆軽量）  
- **AI**: Google Gemini（構造化出力、必要に応じてWeb検索によるグラウンディング）  

---

### 現在の対応OSとロードマップ
- **現状**: Windows 10/11  
- **今後**: macOS / Linux への対応を計画中（Tauri ベースのため移植性あり。配布形式・署名・自動アップデートの整備を進めます）

---

### 改善中 & これから強化したいこと
- **プロンプト生成機能の精度向上**  
  - 行文脈に応じた自動補助、Few-shotの自動抽出、曖昧さの低減
- **データ付与（構造化）の精度と堅牢性**  
  - スキーマバリデーションの強化、欠損・型不一致時の自動補完/フォールバック、再試行戦略
- **システムプロンプト編集の開放**  
  - 上級者向けに、構造化や検索の方針をUIから調整できるようにする
- **クロスプラットフォーム配布**  
  - macOS / Linux のビルド・署名・自動更新パイプライン整備

---

### インストールとビルド
- 推奨: 最新リリースの Windows インストーラ（.exe）をダウンロードして実行

@[card](https://github.com/takapi-s/staf/releases)
- 開発者向け（ソースからビルド）

```bash
git clone https://github.com/takapi-s/staf.git
npm install
npm run tauri:dev   # 開発モード起動
npm run tauri:build # 本番ビルド（インストーラ生成）
```

### オープンソースにした理由
このツールはAIを活用して開発を進めています。自分だけでは見落とす設計や改善点も多く、オープンにしてフィードバックをいただきながら、精度・使いやすさ・運用性を一緒に高めていきたいと考えています。コードレビューやIssue・PRは大歓迎です。


STAF は、AIでCSVを拡張（エンリッチ）するためのツールです。まずは小規模データで試し、テンプレート化してチームに広げてください。

---

### 参考リンク
@[card](https://github.com/takapi-s/staf)
@[card](https://ai.google.dev/)
---
